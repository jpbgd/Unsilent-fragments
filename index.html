<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <title>Silent Fragments</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      width: 100%; height: 100%; overflow: hidden;
      background: #fff;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      -webkit-user-select: none; user-select: none;
    }

```
#intro {
  position: fixed; inset: 0; background: #fff;
  display: flex; align-items: center; justify-content: center;
  z-index: 100; transition: opacity 2s ease-out;
}
#intro.fade { opacity: 0; pointer-events: none; }
#intro h1 { font-size: 24px; font-weight: 300; color: #111; letter-spacing: 2px; }

#app {
  width: 100%; height: 100%; display: flex; flex-direction: column;
  padding: 12px; padding-top: max(12px, env(safe-area-inset-top));
}

#header {
  text-align: center; padding: 8px 0;
}
#header h2 {
  font-size: 15px; font-weight: 300; color: #111; opacity: 0.7;
  letter-spacing: 1px;
}

#photoArea {
  flex: 1; display: flex; align-items: center; justify-content: center;
  min-height: 0; padding: 8px 0;
}
#photo {
  max-width: 100%; max-height: 100%; object-fit: contain;
  box-shadow: 0 2px 15px rgba(0,0,0,0.08);
}

#footer {
  display: flex; align-items: center; padding: 8px 0;
  padding-bottom: max(8px, env(safe-area-inset-bottom));
}
#footer > div { flex: 1; }
#footer .left { text-align: left; }
#footer .center { text-align: center; }
#footer .right { text-align: right; }

#footer button {
  background: none; border: none; font-family: inherit;
  font-size: 13px; font-weight: 300; color: #111; opacity: 0.7;
  padding: 8px; cursor: pointer;
}
#footer .date { font-style: italic; }
#footer svg { vertical-align: middle; }

#commentModal {
  position: fixed; inset: 0; z-index: 50;
  display: none; align-items: center; justify-content: center;
}
#commentModal.show { display: flex; }

#commentBox {
  width: 90%; max-width: 400px; text-align: center; padding: 20px;
}
#commentInput {
  width: 100%; height: 80px; background: transparent; border: none;
  font-family: inherit; font-size: 16px; font-weight: 300;
  text-align: center; color: rgba(255,255,255,0.9); resize: none;
  outline: none; line-height: 1.5;
  text-shadow: 0 1px 3px rgba(0,0,0,0.3);
}
#commentInput::placeholder {
  color: rgba(255,255,255,0.7);
}
#dissolveMsg {
  font-size: 16px; font-weight: 300; color: rgba(255,255,255,0.9);
  text-shadow: 0 1px 3px rgba(0,0,0,0.3);
  transition: opacity 3.5s, filter 3.5s;
  line-height: 1.5;
}
#mergedMsg {
  font-size: 14px; font-weight: 300; color: rgba(255,255,255,0.8);
}
#submitBtn {
  background: none; border: none; padding: 12px; margin-top: 10px;
  color: rgba(255,255,255,0.9); cursor: pointer;
}
.hidden { display: none !important; }

#contactSheet {
  position: fixed; inset: 0; background: #fff; z-index: 50;
  display: none;
}
#contactSheet.show { display: block; }
#contactClose {
  position: absolute; top: 16px; right: 16px; z-index: 60;
  background: none; border: none; color: #111; opacity: 0.5;
  cursor: pointer; padding: 8px;
}
#contactHint {
  position: absolute; left: 50%; bottom: 12px;
  transform: translateX(-50%);
  font-size: 13px; font-weight: 300; color: #111; opacity: 0.7;
  z-index: 60;
}
.contactImg {
  position: absolute;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  transition: filter 0.3s, opacity 0.3s, transform 0.1s;
}
.contactImg.dragging {
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
  transform: scale(1.03);
}
.contactImg.faded { filter: blur(4px); opacity: 0.3; }

#commentsView {
  position: fixed; inset: 0; background: #fff; z-index: 50;
  display: none; overflow: auto; padding: 24px;
}
#commentsView.show { display: block; }
#commentsViewClose {
  position: absolute; top: 24px; right: 24px;
  background: none; border: none; color: #111; opacity: 0.5;
  cursor: pointer; padding: 8px;
}
#commentsText {
  font-size: 10px; line-height: 1.8; color: #111; opacity: 0.7;
  font-weight: 300;
}

#idleVideo {
  position: fixed; z-index: 200; display: none;
  width: 60%; max-height: 70%; object-fit: contain;
  transform: translate(-50%, -50%);
}
#idleVideo.show { display: block; }

@media (min-width: 769px) {
  #app { padding: 24px; }
  #header h2 { font-size: 16px; }
  #footer button { font-size: 14px; }
  #photo { max-width: 42rem; }
}
```

  </style>
</head>
<body>

<div id="intro"><h1>Silent Fragments</h1></div>

<div id="app">
  <div id="header"><h2>Silent Fragments</h2></div>
  <div id="photoArea"><img id="photo" src="" alt=""></div>
  <div id="footer">
    <div class="left">
      <button id="gridBtn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <circle cx="7" cy="7" r="3"></circle><circle cx="17" cy="7" r="3"></circle>
          <circle cx="7" cy="17" r="3"></circle><circle cx="17" cy="17" r="3"></circle>
        </svg>
      </button>
    </div>
    <div class="center">
      <button id="shareBtn">Share your thoughts</button>
    </div>
    <div class="right">
      <button id="dateBtn" class="date"></button>
    </div>
  </div>
</div>

<div id="commentModal">
  <div id="commentBox">
    <div id="inputArea">
      <textarea id="commentInput" placeholder="write down what you're thinking..." 
        data-gramm="false" spellcheck="false" autocomplete="off"></textarea>
    </div>
    <div id="dissolveArea" class="hidden">
      <p id="dissolveMsg"></p>
    </div>
    <div id="mergedArea" class="hidden">
      <p id="mergedMsg">Words merged with image work</p>
    </div>
    <div id="submitArea">
      <button id="submitBtn">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 19.5l15-15m0 0H8.25m11.25 0v11.25"></path>
        </svg>
      </button>
    </div>
  </div>
</div>

<div id="contactSheet">
  <button id="contactClose">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
  </button>
  <p id="contactHint">Reorder freely</p>
  <div id="contactArea"></div>
</div>

<div id="commentsView">
  <button id="commentsViewClose">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
  </button>
  <div id="commentsText"></div>
</div>

<video id="idleVideo" autoplay loop muted playsinline></video>

<script>
(function() {
  var photos = [
    { id: 0, file: 'Untitled_250619.jpg', date: '250619' },
    { id: 1, file: 'Untitled_241221.jpg', date: '241221' },
    { id: 2, file: 'Untitiled_241208.jpg', date: '241208' },
    { id: 3, file: 'Untitiled_241115.jpg', date: '241115' },
    { id: 4, file: 'Untitiled_240714.jpg', date: '240714' }
  ];
  
  var baseUrl = 'https://raw.githubusercontent.com/jpbgd/Silent-fragments/main/';
  var order = shuffle([0,1,2,3,4]);
  var idx = 0;
  var comments = loadComments();
  var idleTimer = null;
  
  // Elements
  var intro = document.getElementById('intro');
  var photo = document.getElementById('photo');
  var dateBtn = document.getElementById('dateBtn');
  var commentModal = document.getElementById('commentModal');
  var commentInput = document.getElementById('commentInput');
  var inputArea = document.getElementById('inputArea');
  var dissolveArea = document.getElementById('dissolveArea');
  var dissolveMsg = document.getElementById('dissolveMsg');
  var mergedArea = document.getElementById('mergedArea');
  var submitArea = document.getElementById('submitArea');
  var contactSheet = document.getElementById('contactSheet');
  var contactArea = document.getElementById('contactArea');
  var commentsView = document.getElementById('commentsView');
  var commentsText = document.getElementById('commentsText');
  var idleVideo = document.getElementById('idleVideo');
  
  // Contact sheet state
  var positions = [];
  var zOrder = [];
  var dragging = null;
  var dragOff = {x:0, y:0};
  var longPress = null;
  var isPress = false;
  var activeImg = null;
  
  function shuffle(a) {
    for (var i = a.length - 1; i > 0; i--) {
      var j = Math.floor(Math.random() * (i + 1));
      var t = a[i]; a[i] = a[j]; a[j] = t;
    }
    return a;
  }
  
  function loadComments() {
    try { return JSON.parse(localStorage.getItem('sfComments')) || {}; }
    catch(e) { return {}; }
  }
  
  function saveComments() {
    try { localStorage.setItem('sfComments', JSON.stringify(comments)); }
    catch(e) {}
  }
  
  function showPhoto() {
    var p = photos[order[idx]];
    photo.src = baseUrl + p.file;
    dateBtn.textContent = p.date;
  }
  
  function nextPhoto() {
    idx = (idx + 1) % order.length;
    showPhoto();
  }
  
  function resetIdle() {
    idleVideo.classList.remove('show');
    clearTimeout(idleTimer);
    idleTimer = setTimeout(function() {
      idleVideo.style.left = (Math.random() * 50 + 25) + '%';
      idleVideo.style.top = (Math.random() * 50 + 25) + '%';
      idleVideo.classList.add('show');
      idleVideo.play();
    }, 10000);
  }
  
  // Init
  showPhoto();
  idleVideo.src = baseUrl + 'Paramo.mp4';
  
  setTimeout(function() {
    intro.classList.add('fade');
  }, 2200);
  
  // Events
  document.getElementById('photoArea').onclick = nextPhoto;
  
  document.getElementById('header').onclick = function() {
    intro.classList.remove('fade');
    setTimeout(function() { intro.classList.add('fade'); }, 3000);
  };
  
  document.getElementById('gridBtn').onclick = function(e) {
    e.stopPropagation();
    openContact();
  };
  
  document.getElementById('shareBtn').onclick = function(e) {
    e.stopPropagation();
    openComment();
  };
  
  dateBtn.onclick = function(e) {
    e.stopPropagation();
    openComments();
  };
  
  commentModal.onclick = function(e) {
    if (e.target === commentModal) closeComment();
  };
  
  document.getElementById('submitBtn').onclick = submitComment;
  
  document.getElementById('contactClose').onclick = function(e) {
    e.stopPropagation();
    closeContact();
  };
  
  contactSheet.onclick = function(e) {
    if (e.target === contactSheet || e.target === contactArea) closeContact();
  };
  
  document.getElementById('commentsViewClose').onclick = closeComments;
  commentsView.onclick = closeComments;
  
  ['mousedown','mousemove','keydown','touchstart','click'].forEach(function(ev) {
    window.addEventListener(ev, resetIdle);
  });
  
  resetIdle();
  
  // Comment functions
  function openComment() {
    commentModal.classList.add('show');
    inputArea.classList.remove('hidden');
    dissolveArea.classList.add('hidden');
    mergedArea.classList.add('hidden');
    submitArea.classList.remove('hidden');
    commentInput.value = '';
    commentInput.focus();
  }
  
  function closeComment() {
    commentModal.classList.remove('show');
  }
  
  function submitComment() {
    var text = commentInput.value.trim();
    if (!text) return;
    
    var pid = photos[order[idx]].id;
    if (!comments[pid]) comments[pid] = [];
    if (comments[pid].length >= 500) comments[pid].shift();
    comments[pid].push(text);
    saveComments();
    
    inputArea.classList.add('hidden');
    submitArea.classList.add('hidden');
    
    dissolveMsg.textContent = text;
    dissolveMsg.style.opacity = '1';
    dissolveMsg.style.filter = 'blur(0)';
    dissolveArea.classList.remove('hidden');
    
    setTimeout(function() {
      dissolveMsg.style.opacity = '0';
      dissolveMsg.style.filter = 'blur(10px)';
    }, 50);
    
    setTimeout(function() {
      dissolveArea.classList.add('hidden');
      mergedArea.classList.remove('hidden');
      setTimeout(closeComment, 1800);
    }, 3500);
  }
  
  // Contact functions
  function openContact() {
    contactSheet.classList.add('show');
    buildContact();
  }
  
  function closeContact() {
    contactSheet.classList.remove('show');
  }
  
  function buildContact() {
    contactArea.innerHTML = '';
    var w = window.innerWidth;
    var h = window.innerHeight;
    var isMobile = w <= 768;
    
    zOrder = shuffle([0,1,2,3,4]);
    
    var zones = isMobile ? [
      {x:0.15,y:0.12},{x:0.60,y:0.18},{x:0.20,y:0.45},{x:0.55,y:0.52},{x:0.35,y:0.72}
    ] : [
      {x:0.12,y:0.10},{x:0.58,y:0.08},{x:0.08,y:0.48},{x:0.52,y:0.52},{x:0.32,y:0.32}
    ];
    zones = shuffle(zones.slice());
    
    positions = [];
    
    photos.forEach(function(p, i) {
      var z = zones[i % zones.length];
      var rx = (Math.random() - 0.5) * 0.08;
      var ry = (Math.random() - 0.5) * 0.08;
      var pw = isMobile ? w * (0.32 + Math.random()*0.06) : w * (0.22 + Math.random()*0.06);
      
      positions[i] = {
        x: (z.x + rx) * w,
        y: (z.y + ry) * h,
        w: pw
      };
      
      var img = document.createElement('img');
      img.src = baseUrl + p.file;
      img.className = 'contactImg';
      img.draggable = false;
      img.style.left = positions[i].x + 'px';
      img.style.top = positions[i].y + 'px';
      img.style.width = positions[i].w + 'px';
      img.style.zIndex = zOrder.indexOf(i) + 1;
      img.dataset.idx = i;
      
      img.onmousedown = function(e) { imgDown(e, i); };
      img.onmouseup = function(e) { imgUp(e, i); };
      img.onmouseenter = function() { imgHover(i, true); };
      img.onmouseleave = function() { imgHover(i, false); };
      img.ontouchstart = function(e) { touchStart(e, i); };
      img.ontouchmove = function(e) { touchMove(e, i); };
      img.ontouchend = function(e) { touchEnd(e, i); };
      
      contactArea.appendChild(img);
    });
    
    document.onmousemove = mouseMove;
    document.onmouseup = mouseUp;
  }
  
  function imgDown(e, i) {
    e.preventDefault();
    var start = Date.now();
    e.target._start = start;
    
    longPress = setTimeout(function() {
      isPress = true;
      dragging = i;
      dragOff = { x: e.clientX - positions[i].x, y: e.clientY - positions[i].y };
      bringFront(i);
      getImg(i).classList.add('dragging');
    }, 150);
  }
  
  function imgUp(e, i) {
    clearTimeout(longPress);
    if (dragging === i) {
      dragging = null;
      getImg(i).classList.remove('dragging');
      setTimeout(function() { isPress = false; }, 50);
    } else if (Date.now() - e.target._start < 200 && !isPress) {
      idx = order.indexOf(i);
      showPhoto();
      closeContact();
    }
  }
  
  function mouseMove(e) {
    if (dragging === null) return;
    positions[dragging].x = e.clientX - dragOff.x;
    positions[dragging].y = e.clientY - dragOff.y;
    var img = getImg(dragging);
    img.style.left = positions[dragging].x + 'px';
    img.style.top = positions[dragging].y + 'px';
  }
  
  function mouseUp() {
    if (dragging !== null) {
      getImg(dragging).classList.remove('dragging');
      dragging = null;
      setTimeout(function() { isPress = false; }, 50);
    }
  }
  
  function touchStart(e, i) {
    if (activeImg !== null && activeImg !== i) { e.preventDefault(); return; }
    clearTimeout(longPress);
    
    var t = e.touches[0];
    e.target._tx = t.clientX;
    e.target._ty = t.clientY;
    e.target._tt = Date.now();
    
    longPress = setTimeout(function() {
      isPress = true;
      dragging = i;
      activeImg = i;
      dragOff = { x: t.clientX - positions[i].x, y: t.clientY - positions[i].y };
      bringFront(i);
      getImg(i).classList.add('dragging');
    }, 80);
  }
  
  function touchMove(e, i) {
    if (activeImg !== null && activeImg !== i) return;
    if (dragging === i && e.touches.length === 1) {
      e.preventDefault();
      var t = e.touches[0];
      positions[i].x = t.clientX - dragOff.x;
      positions[i].y = t.clientY - dragOff.y;
      var img = getImg(i);
      img.style.left = positions[i].x + 'px';
      img.style.top = positions[i].y + 'px';
    } else if (!isPress) {
      clearTimeout(longPress);
    }
  }
  
  function touchEnd(e, i) {
    clearTimeout(longPress);
    if (activeImg !== null && activeImg !== i) return;
    
    if (dragging === i) {
      e.preventDefault();
      dragging = null;
      activeImg = null;
      getImg(i).classList.remove('dragging');
      setTimeout(function() { isPress = false; }, 100);
      return;
    }
    
    var t = e.changedTouches[0];
    var dx = Math.abs(t.clientX - e.target._tx);
    var dy = Math.abs(t.clientY - e.target._ty);
    var dt = Date.now() - e.target._tt;
    
    if (dx < 15 && dy < 15 && dt < 300 && !isPress) {
      idx = order.indexOf(i);
      showPhoto();
      closeContact();
    }
    activeImg = null;
  }
  
  function imgHover(i, on) {
    if (window.innerWidth <= 768) return;
    var imgs = contactArea.getElementsByTagName('img');
    for (var j = 0; j < imgs.length; j++) {
      if (on && j !== i && dragging !== j) {
        imgs[j].classList.add('faded');
      } else {
        imgs[j].classList.remove('faded');
      }
    }
  }
  
  function bringFront(i) {
    zOrder = zOrder.filter(function(x) { return x !== i; });
    zOrder.push(i);
    var imgs = contactArea.getElementsByTagName('img');
    for (var j = 0; j < imgs.length; j++) {
      imgs[j].style.zIndex = zOrder.indexOf(parseInt(imgs[j].dataset.idx)) + 1;
    }
  }
  
  function getImg(i) {
    return contactArea.querySelector('[data-idx="'+i+'"]');
  }
  
  // Comments view
  function openComments() {
    var pid = photos[order[idx]].id;
    var c = comments[pid] || [];
    commentsText.innerHTML = c.length ? c.join(' _ ') : '<span style="opacity:0.4">No thoughts shared yet</span>';
    commentsView.classList.add('show');
  }
  
  function closeComments() {
    commentsView.classList.remove('show');
  }
  
})();
</script>

</body>
</html>